# sfdx-hardis-procedure-installation-claude.md
proc√©dure d'installation cr√©√©e par Claude Sonnet 4.5

# üìã SYNTH√àSE COMPL√àTE : Architecture sfdx-hardis INT/RCT/MAIN

Guide de r√©f√©rence complet pour l'impl√©mentation de votre projet Salesforce DevOps.

---

## üè¢ ARCHITECTURE GLOBALE

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    REPOSITORIES GITHUB                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üì¶ REPO 1: SOURCE OF TRUTH                                    ‚îÇ
‚îÇ  üìä REPO 2: MONITORING                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚¨áÔ∏è
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    SALESFORCE ORGS (4)                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üîß ORG TECHNICAL (Sandbox) - Monitoring & Flow Diff           ‚îÇ
‚îÇ  üü¶ ORG INT (Sandbox) - Int√©gration/D√©veloppement              ‚îÇ
‚îÇ  üü® ORG RCT (Sandbox) - Recette/UAT                            ‚îÇ
‚îÇ  üü• ORG MAIN (Production ou PreProd)                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 1Ô∏è‚É£ ORGS SALESFORCE

### Liste des 4 Orgs

| Org | Type | Usage | Alias | Branche Git |
|-----|------|-------|-------|-------------|
| **Technical Org** | Sandbox | CI/CD operations, Flow Diff, Documentation | `TechnicalOrg` | N/A |
| **INT** | Sandbox | D√©veloppement, Int√©gration | `INT` | `int` |
| **RCT** | Sandbox | Recette, UAT, Tests | `RCT` | `rct` |
| **MAIN** | Production | Production | `MAIN` | `main` |

### R√¥le de chaque Org

#### üîß **Technical Org**
- **Source**: Copie synchronis√©e depuis MAIN (production)
- **Usage**: 
  - G√©n√©ration documentation Flow (avec historique)
  - Op√©rations sfdx-hardis (monitoring, backup)
  - R√©f√©rence "golden master"
  - Comparaisons de m√©tadonn√©es
- **Ne contient PAS**: Donn√©es m√©tier
- **Volume**: ~20,000 artefacts (copie de MAIN)

#### üü¶ **ORG INT**
- **Type**: Sandbox d'int√©gration
- **Usage**: D√©veloppement, int√©gration continue
- **Tests**: RunLocalTests
- **Coverage**: ‚â•75%
- **Timeout**: 60 minutes

#### üü® **ORG RCT**
- **Type**: Sandbox de recette
- **Usage**: Tests UAT, validation pre-prod
- **Tests**: RunLocalTests
- **Coverage**: ‚â•80%
- **Timeout**: 90 minutes

#### üü• **ORG MAIN**
- **Type**: Production
- **Usage**: Production finale
- **Tests**: RunLocalTests
- **Coverage**: ‚â•85%
- **Timeout**: 120 minutes
- **Source pour**: Technical Org, Retrofit

---

## 2Ô∏è‚É£ FICHIERS DE CONFIGURATION (.yml)

### üìÅ Structure compl√®te des fichiers

```
your-salesforce-project/
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îú‚îÄ‚îÄ check-deploy.yml                 ‚Üê PR validation
‚îÇ       ‚îú‚îÄ‚îÄ process-deploy.yml               ‚Üê D√©ploiement r√©el
‚îÇ       ‚îú‚îÄ‚îÄ megalinter.yml                   ‚Üê Qualit√© code
‚îÇ       ‚îú‚îÄ‚îÄ init-technical-org.yml           ‚Üê Init org technique
‚îÇ       ‚îú‚îÄ‚îÄ sync-technical-org.yml           ‚Üê Sync org technique
‚îÇ       ‚îú‚îÄ‚îÄ retrofit-production.yml          ‚Üê Retrofit MAIN
‚îÇ       ‚îú‚îÄ‚îÄ retrofit-rct.yml                 ‚Üê Retrofit RCT
‚îÇ       ‚îî‚îÄ‚îÄ auto-clean-commit.yml            ‚Üê Auto-clean auto
‚îÇ
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ .sfdx-hardis.yml                     ‚Üê CONFIG PRINCIPALE
‚îÇ   ‚îî‚îÄ‚îÄ branches/
‚îÇ       ‚îú‚îÄ‚îÄ .sfdx-hardis-int.yml             ‚Üê Overrides INT
‚îÇ       ‚îú‚îÄ‚îÄ .sfdx-hardis-rct.yml             ‚Üê Overrides RCT
‚îÇ       ‚îî‚îÄ‚îÄ .sfdx-hardis-main.yml            ‚Üê Overrides MAIN
‚îÇ
‚îú‚îÄ‚îÄ manifest/
‚îÇ   ‚îú‚îÄ‚îÄ package.xml
‚îÇ   ‚îî‚îÄ‚îÄ package-skip-items.xml               ‚Üê Exclusions backup
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ apex/
‚îÇ       ‚îî‚îÄ‚îÄ activate-feature-flags.apex      ‚Üê Scripts Apex
‚îÇ
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ .forceignore
‚îú‚îÄ‚îÄ sfdx-project.json
‚îî‚îÄ‚îÄ README.md
```

---

## 3Ô∏è‚É£ FICHIERS YAML √Ä CR√âER

### A. REPO SOURCE OF TRUTH - GitHub Actions (7 fichiers)

#### 1. `.github/workflows/check-deploy.yml`
```yaml
D√©clencheur: Pull Request vers int/rct/main
Fonction: Simule le d√©ploiement (validation)
Commande: sf hardis:project:deploy:smart --check
Secrets utilis√©s:
  - SFDX_CLIENT_ID_{BRANCH}
  - SFDX_CLIENT_KEY_{BRANCH}
  - SFDX_AUTH_URL_TECHNICAL_ORG
  - GITHUB_TOKEN
  - SLACK_TOKEN (optionnel)
```

#### 2. `.github/workflows/process-deploy.yml`
```yaml
D√©clencheur: Push sur int/rct/main
Fonction: D√©ploiement r√©el
Commande: sf hardis:project:deploy:smart
Secrets utilis√©s: (identiques √† check-deploy.yml)
```

#### 3. `.github/workflows/megalinter.yml`
```yaml
D√©clencheur: Push + PR
Fonction: Qualit√© du code (PMD, ESLint, etc.)
Secrets utilis√©s:
  - PAT ou GITHUB_TOKEN
```

#### 4. `.github/workflows/init-technical-org.yml`
```yaml
D√©clencheur: Manuel (workflow_dispatch)
Fonction: Initialisation Technical Org depuis MAIN/RCT/INT
Commandes:
  - sf hardis:org:monitor:backup (avec chunking)
  - sf hardis:project:deploy:smart
Secrets utilis√©s:
  - SFDX_CLIENT_ID_{SOURCE_ORG}
  - SFDX_CLIENT_KEY_{SOURCE_ORG}
  - SFDX_AUTH_URL_TECHNICAL_ORG
```

#### 5. `.github/workflows/sync-technical-org.yml`
```yaml
D√©clencheur: 
  - Apr√®s d√©ploiement MAIN
  - Cron hebdomadaire
  - Manuel
Fonction: Synchronisation Technical Org avec MAIN
Commandes:
  - sf hardis:org:monitor:backup
  - sf hardis:project:deploy:smart
```

#### 6. `.github/workflows/retrofit-production.yml`
```yaml
D√©clencheur: 
  - Cron quotidien (6h)
  - Manuel
Fonction: D√©tecte changements MAIN ‚Üí Cr√©e PR vers INT
Commande: sf hardis:org:retrieve:sources:retrofit
Secrets utilis√©s:
  - SFDX_CLIENT_ID_MAIN
  - SFDX_CLIENT_KEY_MAIN
  - PAT (pour cr√©er PR)
```

#### 7. `.github/workflows/auto-clean-commit.yml`
```yaml
D√©clencheur: 
  - Push sur feature branches
  - Manuel
Fonction: Auto-clean metadata + commit
Commande: sf hardis:work:save --auto-clean
```

### B. REPO SOURCE OF TRUTH - Configuration (4 fichiers)

#### 1. `config/.sfdx-hardis.yml` (PRINCIPAL - ~400 lignes)
```yaml
Sections:
  - Project identification
  - Org configuration (devHub, technical, branches)
  - CI/CD settings
  - Managed packages
  - Metadata filtering & cleanup
  - Permissions & initialization
  - Pre/Post deployment commands
  - Code quality & testing
  - Documentation generation
  - Notifications
  - JIRA integration
  - Scratch org configuration
  - Monitoring configuration
  - Custom Metadata handling
  - Auto-clean configuration (9 types)
  - Retrofit configuration
  - Advanced settings
```

#### 2. `config/branches/.sfdx-hardis-int.yml`
```yaml
Overrides pour INT:
  - deploymentWaitMinutes: 60
  - testWaitMinutes: 60
  - Commandes post-deploy sp√©cifiques INT
```

#### 3. `config/branches/.sfdx-hardis-rct.yml`
```yaml
Overrides pour RCT:
  - deploymentWaitMinutes: 90
  - minCoverageRequired: 80
```

#### 4. `config/branches/.sfdx-hardis-main.yml`
```yaml
Overrides pour MAIN:
  - deploymentWaitMinutes: 120
  - minCoverageRequired: 85
  - Commandes critiques production
```

### C. REPO SOURCE OF TRUTH - Manifest

#### `manifest/package-skip-items.xml`
```xml
Exclusions pour backup monitoring:
  - Translation
  - Report
  - Dashboard
  - Document
  - Namespaced items (et4ae5__*, pi__*, dlrs__*)
```

### D. REPO MONITORING - GitHub Actions (4 fichiers)

#### 1. `.github/workflows/collect-deployment-metrics.yml`
```yaml
D√©clencheur: Cron (toutes les 15 min)
Fonction: Collecte m√©triques de tous les environnements
```

#### 2. `.github/workflows/generate-reports.yml`
```yaml
D√©clencheur: Cron (hebdomadaire)
Fonction: G√©n√©ration rapports et dashboards
```

#### 3. `.github/workflows/health-check.yml`
```yaml
D√©clencheur: Cron (toutes les 4h)
Fonction: Health check des 3 orgs (INT/RCT/MAIN)
```

#### 4. `.github/workflows/analyze-code-quality.yml`
```yaml
D√©clencheur: Cron (quotidien)
Fonction: Analyse qualit√© code (PMD, ESLint, coverage)
```

---

## 4Ô∏è‚É£ SECRETS GITHUB

### REPO SOURCE OF TRUTH - Secrets (Settings > Secrets and variables > Actions)

#### A. Credentials Salesforce (Connected Apps)

```bash
# INT Environment
SFDX_CLIENT_ID_INT          # Connected App Client ID pour org INT
SFDX_CLIENT_KEY_INT         # Private Key (certificat) pour org INT

# RCT Environment
SFDX_CLIENT_ID_RCT          # Connected App Client ID pour org RCT
SFDX_CLIENT_KEY_RCT         # Private Key (certificat) pour org RCT

# MAIN (Production) Environment
SFDX_CLIENT_ID_MAIN         # Connected App Client ID pour org MAIN
SFDX_CLIENT_KEY_MAIN        # Private Key (certificat) pour org MAIN

# Technical Org
SFDX_AUTH_URL_TECHNICAL_ORG # Auth URL compl√®te de l'org technique

# DevHub (si scratch orgs)
SFDX_AUTH_URL_DEV_HUB       # Auth URL du DevHub (optionnel)
```

#### B. GitHub

```bash
PAT                          # Personal Access Token (repo access)
GITHUB_TOKEN                 # Fourni automatiquement par GitHub Actions
```

#### C. Notifications

```bash
# Slack
SLACK_TOKEN                  # Bot User OAuth Token
SLACK_CHANNEL_ID             # Channel par d√©faut
SLACK_CHANNEL_ID_INT         # Channel sp√©cifique INT
SLACK_CHANNEL_ID_RCT         # Channel sp√©cifique RCT
SLACK_CHANNEL_ID_MAIN        # Channel sp√©cifique MAIN

# Email
NOTIF_EMAIL_ADDRESS          # Email par d√©faut
NOTIF_EMAIL_ADDRESS_INT      # Email sp√©cifique INT
NOTIF_EMAIL_ADDRESS_RCT      # Email sp√©cifique RCT
NOTIF_EMAIL_ADDRESS_MAIN     # Email sp√©cifique MAIN

# MS Teams (optionnel)
MS_TEAMS_WEBHOOK_URL         # Webhook MS Teams
```

#### D. JIRA Integration

```bash
JIRA_HOST                    # https://mycompany.atlassian.net
JIRA_EMAIL                   # admin@mycompany.com
JIRA_TOKEN                   # API Token JIRA
JIRA_PAT                     # Personal Access Token (alternative)
JIRA_TICKET_REGEX            # Regex pour d√©tecter tickets (optionnel)
```

#### E. AI Integration (optionnel)

```bash
OPENAI_API_KEY               # Pour analyse erreurs d√©ploiement
```

### REPO SOURCE OF TRUTH - Variables (Settings > Secrets and variables > Actions > Variables)

```bash
SFDX_DEPLOY_WAIT_MINUTES=120
SFDX_TEST_WAIT_MINUTES=120
INSTALL_PACKAGES_TECHNICAL_ORG=true
CI_SOURCES_TO_RETROFIT=CustomObject,CustomField,ValidationRule,PermissionSet,Flow
```

### REPO MONITORING - Secrets

```bash
# Acc√®s aux orgs (lecture seule)
SFDX_AUTH_URL_INT
SFDX_AUTH_URL_RCT
SFDX_AUTH_URL_MAIN
SFDX_AUTH_URL_TECHNICAL_ORG

# Acc√®s au repo source
MONITORING_PAT               # PAT pour lire repo source

# Notifications
SLACK_WEBHOOK_URL            # Pour alertes monitoring
```

### REPO MONITORING - Variables

```bash
SOURCE_REPO_OWNER=mycompany
SOURCE_REPO_NAME=salesforce-source
```

---

## 5Ô∏è‚É£ VARIABLES D'ENVIRONNEMENT PRINCIPALES

### Variables utilis√©es dans les workflows

| Variable | Usage | Valeur type | O√π d√©finie |
|----------|-------|-------------|------------|
| `CI_COMMIT_REF_NAME` | Nom de branche cible | `int`, `rct`, `main` | GitHub Actions (auto) |
| `ORG_ALIAS` | Alias de l'org cible | `INT`, `RCT`, `MAIN` | GitHub Actions (d√©riv√©e) |
| `CONFIG_BRANCH` | Branche de config | `int`, `rct`, `main` | GitHub Actions (d√©riv√©e) |
| `SFDX_DEPLOY_WAIT_MINUTES` | Timeout d√©ploiement | `120` | Variables GitHub |
| `SFDX_TEST_WAIT_MINUTES` | Timeout tests | `120` | Variables GitHub |
| `SFDX_DISABLE_FLOW_DIFF` | D√©sactiver Flow Diff | `false` | .sfdx-hardis.yml |
| `FORCE_COLOR` | Couleurs dans logs | `1` | GitHub Actions |
| `MONITORING_BACKUP_SKIP_METADATA_TYPES` | Types √† ignorer | `Translation,Report` | .sfdx-hardis.yml |

### Variables sfdx-hardis internes (auto-d√©tect√©es)

```bash
# R√©solution automatique par sfdx-hardis
SFDX_CLIENT_ID_{BRANCH}      # Ex: SFDX_CLIENT_ID_INT
SFDX_CLIENT_KEY_{BRANCH}     # Ex: SFDX_CLIENT_KEY_RCT
SLACK_CHANNEL_ID_{BRANCH}    # Ex: SLACK_CHANNEL_ID_MAIN
```

---

## 6Ô∏è‚É£ PROC√âDURES PRINCIPALES

### A. INITIALISATION INITIALE (One-time setup)

#### 1. Cr√©er les Connected Apps Salesforce (4 orgs)

```bash
Pour chaque org (INT, RCT, MAIN, Technical):

1. Setup ‚Üí App Manager ‚Üí New Connected App
2. Nom: "GitHub Actions CI/CD - {ENV}"
3. Enable OAuth Settings
4. Callback URL: http://localhost:1717/OauthRedirect
5. Selected OAuth Scopes:
   - Full access (full)
   - Perform requests at any time (refresh_token, offline_access)
6. Enable "Use digital signatures"
7. Upload certificate (g√©n√©rer avec: openssl req -x509 -newkey rsa:4096)
8. Sauvegarder ‚Üí R√©cup√©rer Consumer Key
9. Stocker dans GitHub Secrets:
   - Consumer Key ‚Üí SFDX_CLIENT_ID_{ENV}
   - Private Key ‚Üí SFDX_CLIENT_KEY_{ENV}
```

#### 2. G√©n√©rer SFDX Auth URL pour Technical Org

```bash
# Se connecter √† Technical Org
sf org login web --alias TechnicalOrg

# G√©n√©rer Auth URL
sf org display --target-org TechnicalOrg --verbose --json | jq -r '.result.sfdxAuthUrl'

# Stocker dans GitHub Secret
# ‚Üí SFDX_AUTH_URL_TECHNICAL_ORG
```

#### 3. Cr√©er les repositories GitHub

```bash
# Repo 1: Source of Truth
- Cr√©er repo: mycompany/salesforce-source
- Prot√©ger branches: int, rct, main
- Ajouter tous les secrets

# Repo 2: Monitoring
- Cr√©er repo: mycompany/salesforce-monitoring
- Ajouter secrets monitoring
```

#### 4. Initialiser Technical Org

```bash
# Via GitHub Actions
gh workflow run init-technical-org.yml \
  -f source_org=main \
  -f backup_mode=filtered \
  -f chunk_size=1000

# Dur√©e: 30-60 minutes (20k artifacts)
```

### B. WORKFLOW QUOTIDIEN

#### Flow de d√©veloppement complet

```
1. D√©veloppeur cr√©e feature branch depuis int
   ‚Üì
2. D√©veloppeur fait changements + commit + push
   ‚Üì
3. Cr√©e Pull Request vers int
   ‚Üì
4. check-deploy.yml s'ex√©cute (validation)
   ‚Üì
5. Review + Approbation
   ‚Üì
6. Merge dans int
   ‚Üì
7. process-deploy.yml s'ex√©cute ‚Üí D√©ploie vers ORG INT
   ‚Üì
8. Tests OK ‚Üí PR de int vers rct
   ‚Üì
9. check-deploy.yml valide vers RCT
   ‚Üì
10. Merge dans rct ‚Üí D√©ploie vers ORG RCT
    ‚Üì
11. UAT OK ‚Üí PR de rct vers main
    ‚Üì
12. check-deploy.yml valide vers MAIN (strict)
    ‚Üì
13. Approbation manager + Merge
    ‚Üì
14. D√©ploiement PRODUCTION
    ‚Üì
15. sync-technical-org.yml se d√©clenche automatiquement
```

### C. OP√âRATIONS PLANIFI√âES

#### Quotidiennes

```yaml
06h00: retrofit-production.yml
       ‚Üí D√©tecte changements MAIN non dans Git
       ‚Üí Cr√©e PR si changements

06h30: collect-deployment-metrics.yml (monitoring)
       ‚Üí Collecte m√©triques toutes les 15min en r√©alit√©
```

#### Hebdomadaires

```yaml
Dimanche 02h00: sync-technical-org.yml
                ‚Üí Synchronisation compl√®te Technical Org

Lundi 08h00: generate-reports.yml (monitoring)
             ‚Üí G√©n√©ration rapports hebdomadaires

Vendredi 06h00: retrofit-rct.yml
                ‚Üí Retrofit des changements RCT
```

#### Toutes les 4 heures

```yaml
health-check.yml (monitoring)
‚Üí V√©rifie sant√© des 3 orgs
```

### D. COMMANDES MANUELLES UTILES

#### D√©ploiement

```bash
# Check deploy local
sf hardis:project:deploy:smart --check --target-org INT

# Deploy r√©el local
sf hardis:project:deploy:smart --target-org RCT

# Deploy rapide (quick deploy apr√®s validation)
sf hardis:deploy:quick --job-id 0Af... --target-org MAIN
```

#### Monitoring & Backup

```bash
# Backup org avec chunking (20k+ artifacts)
sf hardis:org:monitor:backup \
  --target-org MAIN \
  --full \
  --exclude-namespaces \
  --full-apply-filters \
  --max-by-chunk 1000

# Backup mode filtered (recommand√©)
sf hardis:org:monitor:backup --target-org MAIN
```

#### Retrofit

```bash
# Retrofit depuis MAIN vers INT
sf hardis:org:retrieve:sources:retrofit \
  --productionbranch main \
  --retrofitbranch int \
  --commit \
  --commitmode updated \
  --push \
  --pushmode mergerequest \
  --target-org MAIN
```

#### Auto-clean

```bash
# Auto-clean complet
sf hardis:work:save --auto-clean

# Auto-clean types sp√©cifiques
sf hardis:work:save --auto-clean-types "minimizeProfiles,listViewsMine,systemDebug"

# Juste le nettoyage sans commit
sf hardis:project:clean
```

#### Custom Metadata

```bash
# R√©cup√©rer tous les Custom Metadata
sf hardis:org:retrieve:sources:metadata \
  --metadata-types CustomMetadata \
  --target-org MAIN

# D√©ployer Custom Metadata sp√©cifiques
sf project deploy start \
  --metadata "CustomMetadata:MyApp__*INT*" \
  --target-org INT
```

---

## 7Ô∏è‚É£ CHECKLIST DE D√âPLOIEMENT

### Phase 1: Setup initial (1 jour)

```markdown
‚ñ° Cr√©er Connected Apps (INT, RCT, MAIN, Technical)
‚ñ° G√©n√©rer certificats et private keys
‚ñ° Configurer GitHub Secrets (tous)
‚ñ° Cr√©er repositories GitHub (source + monitoring)
‚ñ° Prot√©ger branches (int, rct, main)
‚ñ° Cr√©er fichiers .sfdx-hardis.yml (4 fichiers)
‚ñ° Cr√©er GitHub Actions workflows (11 fichiers)
‚ñ° Cr√©er manifest/package-skip-items.xml
```

### Phase 2: Initialisation Technical Org (2h)

```markdown
‚ñ° Ex√©cuter init-technical-org.yml avec source=main
‚ñ° V√©rifier d√©ploiement Technical Org
‚ñ° Tester g√©n√©ration documentation Flow
‚ñ° Valider backup monitoring (chunking)
```

### Phase 3: Tests CI/CD (1 jour)

```markdown
‚ñ° Cr√©er feature branch test
‚ñ° Faire changement simple (ex: CustomLabel)
‚ñ° Push + cr√©er PR vers int
‚ñ° V√©rifier check-deploy.yml r√©ussit
‚ñ° Merger ‚Üí v√©rifier process-deploy.yml d√©ploie
‚ñ° Tester PR int ‚Üí rct
‚ñ° Tester PR rct ‚Üí main
‚ñ° V√©rifier sync-technical-org apr√®s deploy main
```

### Phase 4: Tests Retrofit (1h)

```markdown
‚ñ° Faire changement manuel en MAIN (ex: cr√©er champ)
‚ñ° Attendre cron ou d√©clencher retrofit-production.yml
‚ñ° V√©rifier PR cr√©√©e automatiquement
‚ñ° Merger PR retrofit
```

### Phase 5: Tests Auto-clean (1h)

```markdown
‚ñ° R√©cup√©rer metadata avec Profiles non minimiz√©s
‚ñ° Ex√©cuter auto-clean
‚ñ° V√©rifier Profiles nettoy√©s
‚ñ° V√©rifier System.debug comment√©s
‚ñ° V√©rifier ListView Mine converties
```

### Phase 6: Configuration Monitoring (2h)

```markdown
‚ñ° Cr√©er workflows monitoring (4 fichiers)
‚ñ° Tester collect-deployment-metrics.yml
‚ñ° V√©rifier g√©n√©ration rapports
‚ñ° Configurer dashboards
‚ñ° Tester health-check.yml
```

### Phase 7: Documentation & Formation (1 jour)

```markdown
‚ñ° Documenter architecture
‚ñ° Cr√©er runbook pour √©quipe
‚ñ° Former d√©veloppeurs sur workflow
‚ñ° Documenter proc√©dures d'urgence
‚ñ° Tester rollback
```

---

## 8Ô∏è‚É£ R√âSUM√â DES COMMANDES PRINCIPALES

### Commandes sfdx-hardis essentielles

```bash
# Authentification
sf hardis:auth:login

# D√©ploiement
sf hardis:project:deploy:smart --check        # Validation
sf hardis:project:deploy:smart                # D√©ploiement r√©el

# Monitoring
sf hardis:org:monitor:backup                  # Backup filtered
sf hardis:org:monitor:backup --full           # Backup complet

# Retrofit
sf hardis:org:retrieve:sources:retrofit       # R√©cup changements prod

# Auto-clean
sf hardis:work:save --auto-clean              # Nettoyage + commit

# Documentation
sf hardis:doc:project:generate                # G√©n√©ration doc

# Configuration
sf hardis:project:configure                   # Update config files
```

---

## 9Ô∏è‚É£ M√âTRIQUES & KPIs

### √Ä surveiller (dashboards monitoring)

```yaml
D√©ploiements:
  - Success Rate: >90%
  - Average Duration: <60min
  - Failed Deployments: <3/semaine
  - Deployment Frequency: tracking

Code Quality:
  - Test Coverage: >75% (INT), >80% (RCT), >85% (MAIN)
  - PMD Score: >3/5
  - ESLint Errors: 0

Retrofit:
  - Production Changes: tracking
  - Retrofit PRs: tracking
  - Time to Merge Retrofit: <48h

Technical Org:
  - Sync Frequency: quotidien
  - Sync Success Rate: >95%
  - Metadata Count: ~20,000
```

---

## üéØ PROCHAINES √âTAPES

### Actions imm√©diates

1. **Cr√©er Connected Apps** (2h)
2. **Configurer GitHub Secrets** (30min)
3. **Cr√©er config/.sfdx-hardis.yml** (1h)
4. **Cr√©er workflows GitHub Actions** (2h)
5. **Initialiser Technical Org** (1h)
6. **Tests CI/CD complets** (4h)

### Semaine 1

- Setup complet infrastructure
- Tests validation compl√®te
- Documentation

### Semaine 2

- Formation √©quipe
- Migration premiers projets
- Monitoring actif

---

## üìö RESSOURCES

### Documentation sfdx-hardis

- https://sfdx-hardis.cloudity.com/
- https://github.com/hardisgroupcom/sfdx-hardis

### Scripts utiles

```bash
# Script validation compl√®te
./scripts/validate-setup.sh

# Script g√©n√©ration secrets
./scripts/generate-secrets.sh

# Script test CI/CD
./scripts/test-cicd.sh
```

---

## üéâ R√âCAPITULATIF FINAL

```
‚úÖ 4 Orgs Salesforce (Technical + INT + RCT + MAIN)
‚úÖ 2 Repositories GitHub (Source + Monitoring)
‚úÖ 15 fichiers YAML (11 workflows + 4 configs)
‚úÖ 25+ Secrets GitHub
‚úÖ 10+ Variables GitHub
‚úÖ 9 types d'auto-clean
‚úÖ 20+ commandes sfdx-hardis
‚úÖ Architecture production-ready
```

**Temps estim√© setup complet**: 3-5 jours

**R√©sultat**: Pipeline CI/CD professionnel, scalable, avec monitoring complet ! üöÄ

---

Voulez-vous que je g√©n√®re des **scripts d'installation automatis√©e** ou un **guide d√©taill√© √©tape par √©tape** pour une section sp√©cifique ?
